<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.studysiba.mapper.member.MemberMapper">


    <!-- 회원가입여부확인 -->
    <select id="registrationStatus" parameterType="MemberVO" resultType="int">
        SELECT COUNT(*) FROM MEMBER
        WHERE MBR_ID = #{mbrId}
    </select>

    <!-- 회원타입값조회 -->
    <select id="getType" parameterType="MemberVO" resultType="String">
        SELECT MBR_TYPE FROM MEMBER
        WHERE MBR_ID = #{mbrId}
    </select>

    <!-- 회원이메일조회 -->
    <select id="getEmail" parameterType="MemberVO" resultType="String">
        SELECT MBR_EMAIL FROM MEMBER
        WHERE MBR_ID = #{mbrId}
    </select>

    <!-- 회원인증코드조회 -->
    <select id="getCode" parameterType="MemberVO" resultType="String">
        SELECT MBR_CODE FROM MEMBER
        WHERE MBR_ID = #{mbrId}
    </select>

    <!-- 회원인증코드갱신 -->
    <select id="renewAuthenticationCode" parameterType="MemberVO">
        UPDATE MEMBER SET MBR_CODE = #{mbrCode}
        WHERE MBR_ID = #{mbrId}
    </select>

    <!-- 회원인증확인 -->
    <select id="informationCheckStatus" parameterType="MemberVO" resultType="int">
        SELECT COUNT(*) FROM MEMBER
        WHERE MBR_ID = #{mbrId} AND MBR_CODE = #{mbrCode}
    </select>

    <!-- 회원활성화 및 코드갱신 -->
    <select id="changeStatus" parameterType="MemberVO">
        UPDATE MEMBER
        SET MBR_TYPE = 'NORMAL', MBR_AUTH = 'NORMAL', MBR_CODE = #{mbrCode}, MBR_CONNECT = NOW(), MBR_JOIN = NOW()
        WHERE MBR_ID = #{mbrId}
    </select>

    <!-- 회원아이디중복조회 -->
    <select id="idReduplicationCheck" parameterType="MemberVO" resultType="int">
        SELECT COUNT(*) FROM MEMBER
        WHERE MBR_ID = #{mbrId}
    </select>

    <!-- 회원이메일인증상태조회 -->
    <select id="emailApprovalStatus" parameterType="MemberVO" resultType="String">
        SELECT MBR_TYPE FROM MEMBER
        WHERE MBR_ID = #{mbrId}
    </select>

    <!-- 회원정보등록 -->
    <insert id="memberRegistration" parameterType="MemberVO">
        <selectKey keyProperty="mbrNo" order="BEFORE" resultType="int">
            SELECT COALESCE(MAX(MBR_NO+1),1) AS MBR_NO FROM MEMBER
        </selectKey>
            INSERT INTO MEMBER(MBR_NO, MBR_TYPE, MBR_AUTH, MBR_CODE, MBR_ID, MBR_PASS, MBR_NICK,MBR_EMAIL, MBR_PROFILE, MBR_CONNECT, MBR_JOIN)
            VALUES(#{mbrNo}, 'NONE', 'NONE', #{mbrCode}, #{mbrId}, #{mbrPass}, #{mbrNick}, #{mbrEmail}, #{mbrProfile}, NOW(), NOW())
    </insert>

    <!-- 회원이메일중복조회 -->
    <select id="emailReduplicationCheck" parameterType="MemberVO" resultType="int">
        SELECT COUNT(*) FROM MEMBER
        WHERE MBR_EMAIL = #{mbrEmail}
    </select>


</mapper>